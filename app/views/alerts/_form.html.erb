<%= form_with(model: alert, local: true) do |form| %>
  <% if alert.errors.any? %>
    <div class="bg-red-50 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-6" role="alert">
      <strong class="font-bold">Error!</strong>
      <span class="block sm:inline">Please fix the following errors:</span>
      <ul class="list-disc list-inside mt-2">
        <% alert.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="space-y-6">
    <div>
      <%= form.label :symbol, "Symbol", class: "block text-sm font-medium text-gray-700 mb-2" %>
      <%= form.select :symbol,
          options_for_select(Alert::SYMBOLS.map { |s| [s, s] }, alert.symbol),
          { prompt: "Select symbol" },
          class: "block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm px-4 py-2 border" %>
    </div>

    <div>
      <%= form.label :threshold_price, "Threshold price ($)", class: "block text-sm font-medium text-gray-700 mb-2" %>
      <%= form.number_field :threshold_price,
          step: :any,
          min: 0,
          class: "block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm px-4 py-2 border",
          placeholder: "For example: 50000.00" %>
    </div>

    <div>
      <%= form.label :direction, "Direction", class: "block text-sm font-medium text-gray-700 mb-2" %>
      <div class="mt-2 space-y-2">
        <label class="inline-flex items-center">
          <%= form.radio_button :direction, 'up', class: "text-indigo-600 focus:ring-indigo-500" %>
          <span class="ml-2">
            <span class="text-green-600">↑</span> Price will rise above the threshold
          </span>
        </label>
        <br>
        <label class="inline-flex items-center">
          <%= form.radio_button :direction, 'down', class: "text-indigo-600 focus:ring-indigo-500" %>
          <span class="ml-2">
            <span class="text-red-600">↓</span> Price will fall below the threshold
          </span>
        </label>
      </div>
    </div>

    <div>
      <%= form.label :exchange, "Exchange", class: "block text-sm font-medium text-gray-700 mb-2" %>
      <%= form.select :exchange,
          options_for_select([['Binance', 'binance']], alert.exchange),
          {},
          class: "block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm px-4 py-2 border" %>
    </div>

    <div>
      <%= form.label :status, "Status", class: "block text-sm font-medium text-gray-700 mb-2" %>
      <%= form.select :status,
          options_for_select([['Active', 'active'], ['Triggered', 'triggered']], alert.status),
          {},
          class: "block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm px-4 py-2 border" %>
    </div>

    <!-- Notification Channels -->
    <div>
      <div class="flex items-center justify-between mb-4">
        <div>
          <label class="block text-sm font-medium text-gray-700">Notification Channels</label>
          <p class="text-sm text-gray-600">Select channels to receive notifications</p>
        </div>
        <%= link_to "Manage Channels", notification_channels_path, 
            class: "text-sm text-indigo-600 hover:text-indigo-800 font-medium" %>
      </div>

      <% if @available_channels&.any? %>
        <div class="space-y-3">
          <% @available_channels.each do |channel| %>
            <div class="relative">
              <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer transition-colors">
                <div class="flex items-center h-5">
                  <%= check_box_tag "notification_channel_ids[]", channel.id, 
                      alert.notification_channels.include?(channel),
                      class: "focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded",
                      id: "channel_#{channel.id}" %>
                </div>
                <div class="ml-3 flex-1">
                  <div class="flex items-center space-x-2">
                    <div class="w-8 h-8 rounded-full flex items-center justify-center text-sm <%= channel_icon_color(channel) %>">
                      <%= case channel.type
                          when 'LogChannel' then '📝'
                          when 'EmailChannel' then '✉️'
                          when 'TelegramChannel' then '📱'
                          else '📢'
                          end %>
                    </div>
                    <div>
                      <div class="text-sm font-medium text-gray-900">
                        <%= channel.title %>
                      </div>
                      <div class="text-xs text-gray-500">
                        <%= case channel.type
                            when 'LogChannel' then 'System logs'
                            when 'EmailChannel' then 'Email notifications'
                            when 'TelegramChannel' then 'Telegram messages'
                            end %>
                      </div>
                    </div>
                  </div>
                </div>
              </label>
            </div>
          <% end %>
        </div>
      <% else %>
        <div class="text-center py-8 border-2 border-dashed border-gray-300 rounded-lg">
          <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
          </svg>
          <h3 class="mt-2 text-sm font-medium text-gray-900">No notification channels</h3>
          <p class="mt-1 text-sm text-gray-500">Create a notification channel first to receive alerts.</p>
          <div class="mt-6">
            <%= link_to "Create Channel", new_notification_channel_path, 
                class: "inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700" %>
          </div>
        </div>
      <% end %>
    </div>

    <div class="flex items-center justify-between pt-4">
      <%= form.submit alert.new_record? ? "Create alert" : "Update alert",
          class: "bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-200" %>

      <%= link_to "Cancel", alerts_path,
          class: "bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded transition duration-200" %>
    </div>
  </div>
<% end %>